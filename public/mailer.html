<!DOCTYPE html>
<!--
Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
-->
<html>
<head>
	<meta charset="utf-8">
	<title>Email HTML Editor</title>
	<script src="ckeditor/ckeditor.js"></script>
	<script src="lib/jquery-2.1.0.min.js"></script>

	<link rel="stylesheet" href="sample.css">
	<script>

		var editor, html = '';

		function createEditor() {
			if ( editor )
				return;

			// Create a new editor inside the <div id="editor">, setting its value to html
			var config = {};
			editor = CKEDITOR.appendTo( 'editor', config, html );
		}

		function removeEditor() {
			if ( !editor )
				return;

			// Retrieve the editor contents. In an Ajax application, this data would be
			// sent to the server or used in any other way.
			var htmlMail = html = editor.getData();
			console.log(htmlMail);

			$.ajax({
				type: "POST",
				url: "/premailer/",
				data: {html: htmlMail},
				success: function(data, textStatus, jqXHR){
					document.getElementById( 'editorcontents' ).innerHTML = data;
					document.getElementById( 'contents' ).style.display = '';
					// Destroy the editor.
					editor.destroy();
					editor = null;
				},
				error: function (jqXHR, textStatus, errorThrown){
					alert("ERROR " + textStatus);
				}
			});
		}

	</script>
</head>
<body>
	<h1>
		HTML Mail Editor: create html content compatible with email clients
	</h1>

	<p>Click the buttons to create and save a a new email</p>
	<p>
		<input onclick="createEditor();" type="button" value="Create Mail">
		<input onclick="removeEditor();" type="button" value="Validate and save Mail">
	</p>
	<!-- This div will hold the editor. -->
	<div id="editor">
	</div>
	<div id="contents" style="display: none">
		<!-- This div will be used to display the editor contents. -->
		<div id="editorcontents">
		</div>
	</div>
	<div id="footer">
		<hr>
		<p id="copy">
			Copyright &copy; 2014, <a class="samples" href="http://twitter.com/fXzo">@fXzo</a> - Fabrice CROISEAUX.
		</p>
	</div>
</body>
</html>
